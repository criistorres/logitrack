# ==============================================================================
# LOGITRACK - SIMULA√á√ÉO DE CASOS REAIS DE USO
# ==============================================================================
# 
# üìã Este arquivo simula os casos de uso reais documentados:
# - Caso 1: Entrega Direta com √önico Motorista
# - Caso 2: Transfer√™ncia Planejada entre Motoristas
#
# üéØ ORDEM DE EXECU√á√ÉO:
# 1. Configurar usu√°rios
# 2. Executar Caso 1 completo
# 3. Executar Caso 2 completo
# 4. Verificar resultados
#
# ==============================================================================

# VARI√ÅVEIS GLOBAIS
@baseURL = http://localhost:8000
@authURL = {{baseURL}}/api/auth
@otsURL = {{baseURL}}/api/ots

# Tokens de usu√°rios
@tokenCarlos = 
@tokenJose = 
@tokenAntonio = 
@tokenLogistica = 

# IDs din√¢micos
@otCaso1 = 
@otCaso2 = 
@transferenciaId = 

# ==============================================================================
# üîê CONFIGURA√á√ÉO INICIAL - CRIAR/LOGAR USU√ÅRIOS
# ==============================================================================

### Setup 1.1 - Registrar Carlos (Motorista do Caso 1)
POST {{authURL}}/register/
Content-Type: application/json

{
    "email": "carlos.motorista@empresa.com",
    "password": "Carlos123!",
    "password_confirm": "Carlos123!",
    "first_name": "Carlos",
    "last_name": "Silva",
    "cpf": "11111111111",
    "phone": "11999111111",
    "role": "motorista",
    "cnh_numero": "11111111111",
    "cnh_categoria": "C",
    "cnh_validade": "2026-12-31"
}

### Setup 1.2 - Login Carlos
POST {{authURL}}/login/
Content-Type: application/json

{
    "email": "carlos.motorista@empresa.com",
    "password": "Carlos123!"
}

# üö® COPIE o access_token para @tokenCarlos

### Setup 2.1 - Registrar Jos√© (Motorista do Caso 2 - Caminh√£o Grande)
POST {{authURL}}/register/
Content-Type: application/json

{
    "email": "jose.caminhao@empresa.com",
    "password": "Jose123!",
    "password_confirm": "Jose123!",
    "first_name": "Jos√©",
    "last_name": "Santos",
    "cpf": "22222222222",
    "phone": "11999222222",
    "role": "motorista",
    "cnh_numero": "22222222222",
    "cnh_categoria": "E",
    "cnh_validade": "2026-12-31"
}

### Setup 2.2 - Login Jos√©
POST {{authURL}}/login/
Content-Type: application/json

{
    "email": "jose.caminhao@empresa.com",
    "password": "Jose123!"
}

# üö® COPIE o access_token para @tokenJose

### Setup 3.1 - Registrar Ant√¥nio (Motorista do Caso 2 - Van)
POST {{authURL}}/register/
Content-Type: application/json

{
    "email": "antonio.van@empresa.com",
    "password": "Antonio123!",
    "password_confirm": "Antonio123!",
    "first_name": "Ant√¥nio",
    "last_name": "Oliveira",
    "cpf": "33333333333",
    "phone": "11999333333",
    "role": "motorista",
    "cnh_numero": "33333333333",
    "cnh_categoria": "B",
    "cnh_validade": "2026-12-31"
}

### Setup 3.2 - Login Ant√¥nio
POST {{authURL}}/login/
Content-Type: application/json

{
    "email": "antonio.van@empresa.com",
    "password": "Antonio123!"
}

# üö® COPIE o access_token para @tokenAntonio

### Setup 4.1 - Registrar Log√≠stica
POST {{authURL}}/register/
Content-Type: application/json

{
    "email": "logistica@empresa.com",
    "password": "Logistica123!",
    "password_confirm": "Logistica123!",
    "first_name": "Maria",
    "last_name": "Log√≠stica",
    "cpf": "44444444444",
    "phone": "11999444444",
    "role": "logistica"
}

### Setup 4.2 - Login Log√≠stica
POST {{authURL}}/login/
Content-Type: application/json

{
    "email": "logistica@empresa.com",
    "password": "Logistica123!"
}

# üö® COPIE o access_token para @tokenLogistica

# ==============================================================================
# üìã CASO 1: ENTREGA DIRETA COM √öNICO MOTORISTA
# ==============================================================================
# 
# üéØ Cen√°rio: Carlos √© motorista da transportadora e precisa fazer um 
# carregamento no CD de S√£o Paulo para entrega em Campinas.
#
# Fluxo:
# 1. Carlos chega ao CD (7:30h)
# 2. Processo de carregamento (8:00h)
# 3. In√≠cio do transporte (9:15h)
# 4. Entrega ao cliente (11:30h)
# 5. Visualiza√ß√£o pela equipe de log√≠stica
#
# ==============================================================================

### CASO 1 - Passo 1: Carlos chega ao CD e registra chegada (7:30h)
POST {{otsURL}}/
Authorization: Bearer {{tokenCarlos}}
Content-Type: application/json

{
    "cliente_nome": "Empresa ABC",
    "endereco_entrega": "Rua das Flores, 123 - Centro",
    "cidade_entrega": "Campinas",
    "observacoes": "Carregamento CD S√£o Paulo ‚Üí Campinas",
    "latitude_origem": -23.5505,
    "longitude_origem": -46.6333,
    "endereco_origem": "CD S√£o Paulo - Vila Ol√≠mpia"
}

# üö® COPIE o ID da OT para @otCaso1
# Simula√ß√£o: 7:30h - Carlos cria OT ao chegar no CD
# Sistema gera: OT2025042600123

### CASO 1 - Passo 2: Carlos atualiza durante carregamento (8:00h)
PATCH {{otsURL}}/{{otCaso1}}/
Authorization: Bearer {{tokenCarlos}}
Content-Type: application/json

{
    "observacoes": "Cliente: Empresa ABC | Endere√ßo: Rua das Flores, 123 - Campinas | Tipo: Carga geral",
    "status": "EM_CARREGAMENTO"
}

# Simula√ß√£o: Carlos adiciona mais detalhes enquanto equipe carrega

### CASO 1 - Passo 2.1: Carlos registra in√≠cio do carregamento
PATCH {{otsURL}}/{{otCaso1}}/status/
Authorization: Bearer {{tokenCarlos}}
Content-Type: application/json

{
    "status": "EM_CARREGAMENTO",
    "observacao": "Equipe do CD iniciou carregamento - Carga geral para Empresa ABC"
}

### CASO 1 - Passo 3: Carlos inicia transporte (9:15h)
PATCH {{otsURL}}/{{otCaso1}}/status/
Authorization: Bearer {{tokenCarlos}}
Content-Type: application/json

{
    "status": "EM_TRANSITO",
    "observacao": "Carregamento conclu√≠do - Saindo do CD. ETA Campinas: 11:30h via Anhanguera"
}

# Simula√ß√£o: Carlos confirma que far√° a entrega e registra sa√≠da

### CASO 1 - Passo 4: Carlos chega ao cliente e faz entrega (11:30h)
POST {{otsURL}}/{{otCaso1}}/finalizar/
Authorization: Bearer {{tokenCarlos}}
Content-Type: application/json

{
    "observacoes_entrega": "Entregue ao Sr. Paulo no setor de recebimento. Mercadoria conferida e aceita integralmente.",
    "latitude_entrega": -22.9068,
    "longitude_entrega": -47.0626,
    "endereco_entrega_real": "Empresa ABC - Setor de Recebimento - Portaria Principal"
}

# Simula√ß√£o: Carlos finaliza entrega com canhoto assinado

### CASO 1 - Passo 5: Log√≠stica visualiza entrega conclu√≠da
GET {{otsURL}}/{{otCaso1}}/
Authorization: Bearer {{tokenLogistica}}
Content-Type: application/json

# Simula√ß√£o: Equipe de log√≠stica v√™ em tempo real que entrega foi conclu√≠da
# Podem acessar detalhes sem esperar retorno f√≠sico do documento

### CASO 1 - Verifica√ß√£o: Timeline completa da OT
GET {{otsURL}}/{{otCaso1}}/
Authorization: Bearer {{tokenCarlos}}
Content-Type: application/json

# Verificar se todos os passos foram registrados corretamente

# ==============================================================================
# üìã CASO 2: TRANSFER√äNCIA PLANEJADA ENTRE MOTORISTAS
# ==============================================================================
#
# üéØ Cen√°rio: Sistema de transfer√™ncia entre ve√≠culo maior (Jos√©) que n√£o pode 
# entrar na regi√£o central e ve√≠culo menor (Ant√¥nio) para √∫ltima milha.
#
# Fluxo:
# 1. Jos√© inicia com caminh√£o grande
# 2. Cross-docking em terminal urbano (12:00h)
# 3. Transfer√™ncia para Ant√¥nio (12:30h)
# 4. Ant√¥nio realiza entregas (13:30h - 17:00h)
# 5. Finaliza√ß√£o completa (17:15h)
#
# ==============================================================================

### CASO 2 - Passo 1: Jos√© chega ao CD com caminh√£o grande
POST {{otsURL}}/
Authorization: Bearer {{tokenJose}}
Content-Type: application/json

{
    "cliente_nome": "Rota Centro SP",
    "endereco_entrega": "Centro de S√£o Paulo - M√∫ltiplas entregas",
    "cidade_entrega": "S√£o Paulo",
    "observacoes": "5 entregas centro SP - transferir para van | Zona de restri√ß√£o para ve√≠culos grandes",
    "latitude_origem": -23.5505,
    "longitude_origem": -46.6333,
    "endereco_origem": "CD Principal - S√£o Paulo"
}

# üö® COPIE o ID da OT para @otCaso2
# Simula√ß√£o: Jos√© cria OT sabendo que ser√° transferida

### CASO 2 - Passo 1.1: Jos√© registra carregamento
PATCH {{otsURL}}/{{otCaso2}}/status/
Authorization: Bearer {{tokenJose}}
Content-Type: application/json

{
    "status": "EM_CARREGAMENTO",
    "observacao": "Carregando mercadorias para 5 clientes no centro. Planejamento: transferir no terminal urbano."
}

### CASO 2 - Passo 1.2: Jos√© inicia transporte para terminal
PATCH {{otsURL}}/{{otCaso2}}/status/
Authorization: Bearer {{tokenJose}}
Content-Type: application/json

{
    "status": "EM_TRANSITO",
    "observacao": "Saindo para terminal urbano - Cross-docking planejado √†s 12:00h"
}

### CASO 2 - Passo 2: Jos√© chega ao terminal urbano (12:00h)
POST {{otsURL}}/{{otCaso2}}/transferir/
Authorization: Bearer {{tokenJose}}
Content-Type: application/json

{
    "motorista_destino_id": 3,
    "motivo": "Transfer√™ncia planejada - Ve√≠culo grande n√£o pode entrar no centro. Transferindo para van.",
    "latitude": -23.5400,
    "longitude": -46.6200,
    "endereco": "Terminal Urbano - P√°tio de Cross-docking"
}

# üö® SUBSTITUA "3" pelo ID real do Ant√¥nio
# üö® COPIE o ID da transfer√™ncia para @transferenciaId
# Simula√ß√£o: Jos√© transfere conforme planejado

### CASO 2 - Passo 3: Ant√¥nio verifica transfer√™ncias pendentes
GET {{otsURL}}/transferencias/minhas/
Authorization: Bearer {{tokenAntonio}}
Content-Type: application/json

# Ant√¥nio v√™ que h√° uma transfer√™ncia aguardando sua aceita√ß√£o

### CASO 2 - Passo 3.1: Ant√¥nio aceita a transfer√™ncia (12:30h)
POST {{otsURL}}/transferencias/{{transferenciaId}}/aceitar/
Authorization: Bearer {{tokenAntonio}}
Content-Type: application/json

{
    "observacao": "Transfer√™ncia aceita. Conferindo mercadorias e assumindo responsabilidade pelas 5 entregas no centro."
}

# Simula√ß√£o: Ant√¥nio confere mercadorias e aceita formalmente

### CASO 2 - Passo 3.2: Verificar que OT agora √© do Ant√¥nio
GET {{otsURL}}/{{otCaso2}}/
Authorization: Bearer {{tokenAntonio}}
Content-Type: application/json

# Ant√¥nio agora √© o motorista_atual da OT

### CASO 2 - Passo 4: Ant√¥nio inicia entregas no centro (13:30h)
PATCH {{otsURL}}/{{otCaso2}}/status/
Authorization: Bearer {{tokenAntonio}}
Content-Type: application/json

{
    "status": "EM_TRANSITO",
    "observacao": "Iniciando rota de entregas no centro. 1¬™ parada: Rua 25 de Mar√ßo"
}

### CASO 2 - Passo 4.1: Ant√¥nio registra progresso das entregas
PATCH {{otsURL}}/{{otCaso2}}/
Authorization: Bearer {{tokenAntonio}}
Content-Type: application/json

{
    "observacoes": "Progresso entregas: Cliente 1 ‚úì (13:45h) | Cliente 2 ‚úì (14:30h) | Cliente 3 ‚úì (15:15h) | Cliente 4 ‚úì (16:00h) | Cliente 5 ‚úì (16:45h)"
}

# Simula√ß√£o: Ant√¥nio atualiza conforme realiza cada entrega

### CASO 2 - Passo 5: Ant√¥nio finaliza todas as entregas (17:15h)
POST {{otsURL}}/{{otCaso2}}/finalizar/
Authorization: Bearer {{tokenAntonio}}
Content-Type: application/json

{
    "observacoes_entrega": "Todas as 5 entregas realizadas com sucesso no centro de SP. Todos os canhotos coletados. Opera√ß√£o cross-docking conclu√≠da.",
    "latitude_entrega": -23.5475,
    "longitude_entrega": -46.6361,
    "endereco_entrega_real": "Centro SP - √öltima entrega: Rua Direita, 100"
}

# Simula√ß√£o: Ant√¥nio finaliza ap√≥s todas as entregas

### CASO 2 - Verifica√ß√£o: Jos√© v√™ OT finalizada por Ant√¥nio
GET {{otsURL}}/{{otCaso2}}/
Authorization: Bearer {{tokenJose}}
Content-Type: application/json

# Jos√© pode ver que "sua" OT foi finalizada com sucesso por Ant√¥nio
# Hist√≥rico completo mostra toda a opera√ß√£o

### CASO 2 - Verifica√ß√£o: Log√≠stica v√™ opera√ß√£o completa
GET {{otsURL}}/{{otCaso2}}/
Authorization: Bearer {{tokenLogistica}}
Content-Type: application/json

# Log√≠stica v√™ hist√≥rico completo:
# - Criada por Jos√©
# - Transferida para Ant√¥nio  
# - Finalizada por Ant√¥nio

# ==============================================================================
# üìä COMPARA√á√ÉO E AN√ÅLISE DOS CASOS
# ==============================================================================

### An√°lise 1: Estat√≠sticas gerais do dia
GET {{otsURL}}/stats/
Authorization: Bearer {{tokenLogistica}}
Content-Type: application/json

# Log√≠stica v√™ estat√≠sticas de ambos os casos

### An√°lise 2: Hist√≥rico de transfer√™ncias do dia
GET {{otsURL}}/transferencias/minhas/
Authorization: Bearer {{tokenLogistica}}
Content-Type: application/json

# Hist√≥rico de todas as transfer√™ncias realizadas

### An√°lise 3: Performance por motorista
GET {{otsURL}}/buscar/?data_inicio=2024-12-06
Authorization: Bearer {{tokenLogistica}}
Content-Type: application/json

# Busca todas as OTs do dia para an√°lise

# ==============================================================================
# üîÑ CEN√ÅRIO ALTERNATIVO: CASO 2 COM RECUSA
# ==============================================================================
# 
# Simula√ß√£o: E se Ant√¥nio n√£o pudesse aceitar a transfer√™ncia?
#
# ==============================================================================

### Alternativo 1: Jos√© cria nova OT para teste de recusa
POST {{otsURL}}/
Authorization: Bearer {{tokenJose}}
Content-Type: application/json

{
    "cliente_nome": "Teste Recusa Transfer",
    "endereco_entrega": "Endere√ßo de teste",
    "cidade_entrega": "S√£o Paulo",
    "observacoes": "OT para testar cen√°rio de recusa"
}

### Alternativo 2: Jos√© tenta transferir para Ant√¥nio
POST {{otsURL}}/NEW_OT_ID/transferir/
Authorization: Bearer {{tokenJose}}
Content-Type: application/json

{
    "motorista_destino_id": 3,
    "motivo": "Teste de recusa - Ant√¥nio pode estar ocupado"
}

### Alternativo 3: Ant√¥nio recusa por estar ocupado
POST {{otsURL}}/transferencias/NEW_TRANSFER_ID/recusar/
Authorization: Bearer {{tokenAntonio}}
Content-Type: application/json

{
    "observacao": "N√£o posso aceitar - ainda finalizando entregas da OT anterior. Sem disponibilidade no hor√°rio."
}

### Alternativo 4: Log√≠stica faz nova transfer√™ncia
POST {{otsURL}}/NEW_OT_ID/transferir/
Authorization: Bearer {{tokenLogistica}}
Content-Type: application/json

{
    "motorista_destino_id": 4,
    "motivo": "Reagendamento ap√≥s recusa - Transferindo para outro motorista dispon√≠vel"
}

# ==============================================================================
# üì± SIMULA√á√ÉO MOBILE - NOTIFICA√á√ïES E ATUALIZA√á√ïES
# ==============================================================================

### Mobile 1: Jos√© verifica suas OTs no celular
GET {{otsURL}}/?status=ENTREGUE
Authorization: Bearer {{tokenJose}}
Content-Type: application/json

# Simula√ß√£o: Jos√© verifica no app que suas OTs foram finalizadas

### Mobile 2: Ant√¥nio verifica transfer√™ncias pendentes
GET {{otsURL}}/transferencias/minhas/
Authorization: Bearer {{tokenAntonio}}
Content-Type: application/json

# Simula√ß√£o: Ant√¥nio abre app e v√™ notifica√ß√£o de transfer√™ncia

### Mobile 3: Atualiza√ß√£o r√°pida de localiza√ß√£o
PATCH {{otsURL}}/{{otCaso2}}/
Authorization: Bearer {{tokenAntonio}}
Content-Type: application/json

{
    "latitude_origem": -23.5475,
    "longitude_origem": -46.6361,
    "endereco_origem": "Centro SP - Em rota de entrega"
}

# Simula√ß√£o: App mobile envia localiza√ß√£o automaticamente

# ==============================================================================
# üìã RELAT√ìRIO FINAL DOS CASOS
# ==============================================================================

### Relat√≥rio 1: Resumo do Caso 1 (Entrega Direta)
GET {{otsURL}}/debug/{{otCaso1}}/
Authorization: Bearer {{tokenLogistica}}
Content-Type: application/json

# An√°lise completa da opera√ß√£o de Carlos

### Relat√≥rio 2: Resumo do Caso 2 (Transfer√™ncia Planejada)
GET {{otsURL}}/debug/{{otCaso2}}/
Authorization: Bearer {{tokenLogistica}}
Content-Type: application/json

# An√°lise completa da opera√ß√£o Jos√© ‚Üí Ant√¥nio

### Relat√≥rio 3: Compara√ß√£o de efici√™ncia
GET {{otsURL}}/stats/
Authorization: Bearer {{tokenLogistica}}
Content-Type: application/json

# M√©tricas para comparar ambos os modelos operacionais

# ==============================================================================
# üìä BENEF√çCIOS DEMONSTRADOS
# ==============================================================================

"""
‚úÖ CASO 1 - ENTREGA DIRETA:
- Simplicidade operacional
- Responsabilidade √∫nica (Carlos)
- Timeline linear e clara
- Menos pontos de falha

‚úÖ CASO 2 - TRANSFER√äNCIA PLANEJADA:
- Otimiza√ß√£o de recursos (ve√≠culos adequados)
- Especializa√ß√£o por regi√£o
- Maior flexibilidade operacional
- Melhor aproveitamento da frota

üéØ SISTEMA DE ACEITA√á√ÉO:
- Motorista de destino tem controle
- Evita transfer√™ncias for√ßadas
- Permite reagendamentos
- Mant√©m hist√≥rico completo

üì± CARACTER√çSTICAS MOBILE:
- Atualiza√ß√µes em tempo real
- Notifica√ß√µes de transfer√™ncia
- Interface simples para aceita√ß√£o
- Tracking autom√°tico de localiza√ß√£o

üîÑ FLEXIBILIDADE:
- Transfer√™ncia direta (motorista ‚Üí motorista)
- Aprova√ß√£o da log√≠stica (outros casos)
- Cancelamento a qualquer momento
- Hist√≥rico completo de auditoria

üìä VISIBILIDADE:
- Log√≠stica acompanha tudo
- Hist√≥rico por motorista
- M√©tricas de performance
- Rastreabilidade completa
"""